= Farming
Voided Name
v1.0, 2025-12-15
:source-highlighter: rouge
// What a jank pointless pain github inflicts on all of us just because they don't conform to the asciidoc spec... thx: https://github.com/orgs/community/discussions/106933#discussioncomment-14246791 for the fix
ifdef::env-github[]
:MERMAID: source, mermaid
endif::[]
ifndef::env-github[]
:MERMAID: mermaid
endif::[]

Farming is a stardew valley style system built on top of the link:../readme.asciidoc[VN-Suit] framework.

== Project Structure

.Application Interconnections (vn-farming)
[{MERMAID}]
----
graph TD
    vn-farming-native[vn-farming-native]
    vn-farming-web[vn-farming-web]
    vn-farming-logic[vn-farming-logic]
    
    subgraph Core [Core Framework]
        vn-wgpu-window
        vn-ui
        vn-scene
        vn-utils
    end

    vn-farming-native --> vn-farming-logic
    vn-farming-web --> vn-farming-logic

    vn-farming-logic --> vn-wgpu-window
    vn-farming-logic --> vn-ui
    vn-farming-logic --> vn-scene
    vn-farming-logic --> vn-utils
----

.Crate Responsibilities
* *vn-farming-logic*: Contains the application-specific logic as a library crate.
Implements the `MainLogic` trait and exports an `init()` function that bridges to `vn-wgpu-window::init_with_logic()`.

* *vn-farming-native*: Native binary launcher that sets up logging, implements platform-specific file loading, and calls `vn-farming-logic::init()`.

* *vn-farming-web*: WebAssembly binary launcher that sets up web-specific logging, implements browser-based file loading via fetch API, and calls `vn-farming-logic::init()`.

.Launch Flow
[{MERMAID}]
----
sequenceDiagram
    participant Native as vn-farming-native
    participant Web as vn-farming-web
    participant Lib as vn-farming-logic
    participant Window as vn-wgpu-window

    Note over Native: Setup env_logger
    Note over Native: Create FileLoader (fs)
    Native->>Lib: init()
    
    Note over Web: Setup console_log
    Note over Web: Create FileLoader (fetch)
    Web->>Lib: init()

    Lib->>Window: init_with_logic()
    Window->>Window: Create window
    Window->>Window: Initialize WGPU
    Window->>Window: Instantiate MainLogic
    Window->>Window: Run event loop
----

This structure allows the application to share the common framework (vn-wgpu-window, vn-ui) while maintaining separate launcher binaries for different platforms.
The application logic crate (vn-farming-logic) remains platform-agnostic by using trait-based abstractions (like `FileLoader`) for platform-specific functionality.

== Architecture & Design Decisions

.Platform Abstraction (Platform Hooks)
[{MERMAID}]
----
classDiagram
    class PlatformHooks {
        <<trait>>
        +load_file(path)
    }
    class NativePlatformHooks {
        +load_file(path) // uses std::fs
    }
    class WebPlatformHooks {
        +load_file(path) // uses fetch API
    }

    PlatformHooks <|-- NativePlatformHooks
    PlatformHooks <|-- WebPlatformHooks
----

Farming follows a strict separation between application logic and platform-specific entry points.

. **Logic-Crate Pattern**: All application code resides in `vn-farming-logic`. This crate is a library and contains no platform-specific code.
. **Trait-Based Platform Abstraction**: Functionalities like file loading are handled through the `PlatformHooks` trait. `vn-farming-native` provides an implementation using `std::fs`, while `vn-farming-web` provides one using the `fetch` API.
. **Unified Initialization**: Both launchers call a common `init()` function in the logic crate, ensuring consistent behavior across platforms.
. **Asset Management**: Assets are loaded asynchronously (especially important on Web) and managed by the framework's resource manager.

== Farming Features & TODO

.Immediate TODOs
- [ ] Map: A place that entities walk around on
- [ ] Character: A player controlled entity
- [ ] Animations: Character and NPC / Entity animations
- [ ] NPCs
- [ ] Tileset
- [ ] Farming Mechanics: Tilling, watering, planting, and harvesting
- [ ] Inventory System: Item management and toolbar
- [ ] Time & Weather: Day/night cycle and weather effects
- [ ] Interaction System: Talk to NPCs, use tools, pick up items
- [ ] Save/Load System: Persisting player progress
- [ ] Building/Crafting: Placing structures and creating items
- [ ] Sound & Music: Audio feedback and atmosphere
