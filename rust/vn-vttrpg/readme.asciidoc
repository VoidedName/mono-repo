= VTTRPG
Voided Name
v1.0, 2025-12-15
:source-highlighter: rouge

VTTRPG is a virtual table top rpg system built on top of the link:../readme.asciidoc[VN-Suit] framework.

== Project Structure

.Application Interconnections (vn-vttrpg)
[mermaid]
----
graph TD
    vn-vttrpg-native[vn-vttrpg-native]
    vn-vttrpg-web[vn-vttrpg-web]
    vn-vttrpg-logic[vn-vttrpg-logic]
    
    subgraph Core [Core Framework]
        vn-wgpu-window[link:../vn-wgpu-window/readme.asciidoc[vn-wgpu-window]]
        vn-ui[link:../vn-ui/readme.asciidoc[vn-ui]]
        vn-scene[link:../vn-scene/readme.asciidoc[vn-scene]]
        vn-utils[link:../vn-utils/readme.asciidoc[vn-utils]]
    end

    vn-vttrpg-native --> vn-vttrpg-logic
    vn-vttrpg-web --> vn-vttrpg-logic

    vn-vttrpg-logic --> vn-wgpu-window
    vn-vttrpg-logic --> vn-ui
    vn-vttrpg-logic --> vn-scene
    vn-vttrpg-logic --> vn-utils
----

.Crate Responsibilities
* *vn-vttrpg-logic*: Contains the application-specific logic as a library crate.
Implements the `MainLogic` trait and exports an `init()` function that bridges to `vn-wgpu-window::init_with_logic()`.

* *vn-vttrpg-native*: Native binary launcher that sets up logging, implements platform-specific file loading, and calls `vn-vttrpg-logic::init()`.

* *vn-vttrpg-web*: WebAssembly binary launcher that sets up web-specific logging, implements browser-based file loading via fetch API, and calls `vn-vttrpg-logic::init()`.

.Launch Flow
[mermaid]
----
sequenceDiagram
    participant Native as vn-vttrpg-native
    participant Web as vn-vttrpg-web
    participant Lib as vn-vttrpg-logic
    participant Window as vn-wgpu-window

    Note over Native: Setup env_logger
    Note over Native: Create FileLoader (fs)
    Native->>Lib: init()
    
    Note over Web: Setup console_log
    Note over Web: Create FileLoader (fetch)
    Web->>Lib: init()

    Lib->>Window: init_with_logic()
    Window->>Window: Create window
    Window->>Window: Initialize WGPU
    Window->>Window: Instantiate MainLogic
    Window->>Window: Run event loop
----

This structure allows the application to share the common framework (vn-wgpu-window, vn-ui) while maintaining separate launcher binaries for different platforms.
The application logic crate (vn-vttrpg-logic) remains platform-agnostic by using trait-based abstractions (like `FileLoader`) for platform-specific functionality.

== Architecture & Design Decisions

.Platform Abstraction (Platform Hooks)
[mermaid]
----
classDiagram
    class PlatformHooks {
        <<trait>>
        +load_file(path)
    }
    class NativePlatformHooks {
        +load_file(path) // uses std::fs
    }
    class WebPlatformHooks {
        +load_file(path) // uses fetch API
    }

    PlatformHooks <|-- NativePlatformHooks
    PlatformHooks <|-- WebPlatformHooks
----

VTTRPG follows a strict separation between application logic and platform-specific entry points.

. **Logic-Crate Pattern**: All application code resides in `vn-vttrpg-logic`. This crate is a library and contains no platform-specific code.
. **Trait-Based Platform Abstraction**: Functionalities like file loading are handled through the `PlatformHooks` trait. `vn-vttrpg-native` provides an implementation using `std::fs`, while `vn-vttrpg-web` provides one using the `fetch` API.
. **Unified Initialization**: Both launchers call a common `init()` function in the logic crate, ensuring consistent behavior across platforms.
. **Asset Management**: Assets are loaded asynchronously (especially important on Web) and managed by the framework's resource manager.

== VTTRPG Features & TODO

.Immediate TODOs
- [ ] Character Sheet: Basic implementation of stats and skills.
- [ ] Map: Loading and displaying a 2D grid-based map.
- [ ] Player/NPC Token: Rendering and moving tokens on the map.
- [ ] Multiplayer: Synchronizing state between multiple clients.

.Future Ideas
- [ ] Lightshed on a Map
- [ ] Pathing on a Map
- [ ] Automatic Triggers?
- [ ] Pause / Continue
- [ ] GM or Elevated vs Player / Capability System (like player can edit their own sheet)
- [ ] Dice Rolls
- [ ] Mechanics / Rule System?!
